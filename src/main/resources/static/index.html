<!--Navbar -->
<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Unicode Pleco</title>
    <link rel="ICON" href="style/img/ico/favicon.ico" type="image/ico"/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="style/css/bootstrap.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="style/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="style/css/style.css" rel="stylesheet">
    <link href="style/css/fileupload.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: headerFont;
            src: url(style/img/font/ostrich-sans-dashed.ttf);
        }

        @font-face {
            font-family: uom;
            src: url(style/img/font/Lato-Regular.ttf);
        }
    </style>
</head>

<body>
<div class="container-fluid">
    <!-- chatbot -->
    <div id="fb-root"></div>

    <div class="row">
        <div class="col-xl-12" style="padding :0%">
            <!-- nav bar -->
            <nav class="mb-1 navbar navbar-expand-lg navbar-dark #b71c1c red darken-4 ">
                <a class="navbar-brand" href="#">Unicode Pleco</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent-333"
                        aria-controls="navbarSupportedContent-333" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent-333">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">UoM Home
                                <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Advanced Conversions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">About Us</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ml-auto nav-flex-icons">
                        <li class="nav-item active">
                            <a class="nav-link" href="https://www.facebook.com/Unicode-Pleco-1949172665132215/"
                               target="_blank">
                                <i class="fab fa-facebook-f"></i> Facebook
                                <span class="sr-only">(current)</span>
                            </a>
                        </li>
                        <li class="nav-item dropdown authenticated">
                            <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
                               aria-haspopup="true"
                               aria-expanded="false">
                                <i class="fas fa-user"></i> Logged in as: <span id="user"></span> </a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-info"
                                 aria-labelledby="navbarDropdownMenuLink-4">
                                <a class="dropdown-item" href="#">My account</a>
                                <a class="dropdown-item" onClick="logout()">Log out</a>
                            </div>

                        </li>
                        <li class="nav-item dropdown unauthenticated">
                            <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-5" data-toggle="dropdown"
                               aria-haspopup="true"
                               aria-expanded="false">
                                <i class="fas fa-user"></i> Log in with Facebook Or Github</a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-info"
                                 aria-labelledby="navbarDropdownMenuLink-4">
                                <a class="dropdown-item" href="/login/facebook">Login With Facebook</a>
                                <a class="dropdown-item" href="/login/github">Login With Github</a>
                            </div>

                        </li>
                    </ul>
                </div>
            </nav>
            <!-- end of nav bar -->

        </div>
    </div>
    <div class="row">
        <!-- inner nav bar -->
        <div class="container">
            <!-- <br/> -->
            <br/>
            <div class="row">
                <div class="col-md-5">
                    <div class="row">
                        <div class="col-md-3">
                            <a href="#">
                                <img src="style/img/logo/logoUoM.png" style="width :120px; height : 120px" alt="Home">
                            </a>
                        </div>
                        <div class="col-md-9" style="padding-left: 5%">
                            <div class="row">
                                <p style="font-size:29px;font-family: uom  ;font-weight:700;line-height:1.1; margin-bottom:2px;  color:#252525;">
                                    University of Moratuwa</p>
                                <p style="font-size:13px;font-family: uom; font-weight:600;">Wisdom is all wealth</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" style="padding-left :0%">
                    <p style="font-size:85px;font-family:headerFont;font-weight:700;line-height:1.1;color:#252525;">
                        Unicode Pleco</p>
                </div>
                <div class="col-md-3">
                    <a href="#">
                        <img src="style/img/logo/Pleco.jpg" alt="Home">
                    </a>
                </div>
            </div>
        </div>

        <!-- end of inner nav bar -->
    </div>
    <div class="row">
        <div class="col-md-2">
            <p style="font-size:20px;font-family: uom;">Supported Fonts</p>
            <ul class="list-group">
                <li class="list-group-item active #b71c1c red darken-4">Sinhala</li>
                <li class="list-group-item">FMAbaya</li>
                <li class="list-group-item">Thibus16STru</li>
                <li class="list-group-item">FMAbabld</li>
                <li class="list-group-item">Thibus15STru</li>
                <li class="list-group-item">Thibus02S</li>
                <li class="list-group-item">Thibus02STru</li>
                <li class="list-group-item">Thibus05STru</li>
                <li class="list-group-item">Sinhala INetFont</li>
                <li class="list-group-item">DL-Manel</li>
                <li class="list-group-item">Mutu Kata</li>
                <li class="list-group-item">LTRL</li>
            </ul>
        </div>
        <div class="col-md-8">
            <div class="row">
                <p style="font-size:20px;font-family: uom; align-content: center ">Unicode pleco is a universal
                    sinhala/Tamil non unicode to unicode docx converter. The projected was initiated by Natural Language
                    Processing unit in University of Moratuwa and developed by Ciperlabs.The name "Pleco" was derived
                    from "plecostomus". "Plecostomus" is a fish who cleans dirts/algae in the water. We also hope to
                    clen non-unicode text from your docx file.</p>
            </div>
            <div class="row">
                <div class="col-md-12 middleContainer" id="middleContainer">
                    <form action="/upload" class="dropzone needsclick dz-clickable" id="docx_upload">

                        <div class="dz-message needsclick">
                            Drop files here or click to upload.<br>
                            <img src="style/img/word.png" style="width :120px; height : 120px" alt="Home">
                            <img src="style/img/excel.png" style="width :110px; height : 110px" alt="Home">
                        </div>

                    </form>
                    <div class="col-md-2 offset-5">
                        <button type="submit" id="button" onclick="fileUpload()" class="btn">Upload</button>
                    </div>
                    <style>
                        .btn {
                            background-color: #b71c1c;
                            width:300;
                            height: 100
                            /* border-color: #000; */
                        }
                    </style>

                </div>
                <div class="col-md-12 middleContainerProgress" id="middleContainerProgress">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%" id="progressinner">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 10px"></div>
                    <div class="alert alert-success">
                        <strong>Uploading!</strong> Successfully uploaded!
                    </div>

                    <div class="alert alert-info">
                        <strong>Extracting Text</strong>
                    </div>
                    <div class="alert alert-info">
                        <strong>Converting to Unicode!</strong>
                    </div>
                    <div class="alert alert-info">
                        <strong>Refining the conversion</strong>
                    </div>
                    <div class="alert alert-info">
                        <strong>Setting up the styles</strong>
                    </div>

                </div>
                <div class="col-md-12 middleContainerErrorr" id="middleContainerErrorr">
                    <div class="row">
                        <div class="col-md-6 offset-3" align="center">
                            <span class="badge badge-danger"> Error</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 offset-3">
                            <img src="style/img/Oops-404-error.png"  class="img-fluid" alt="" style="display:block;margin:auto; width: 40%;">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 offset-3" align="center">
                            <span class="badge badge-danger"> Your File did not converted successfully due to one or more of following reasons</span>
                        </div>
                        <div class="alert alert-info">
                            <strong>Unsupported File Type</strong> This converter currently support Excel and Docx formats only
                        </div>
                        <div class="alert alert-info">
                            <strong>False Extension</strong> You have changed the extension of the document
                        </div>
                        <div class="alert alert-info">
                            <strong>Internet Connectivity Issue</strong>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 offset-2">
                            <div class="row justify-content-center">
                                <button type="button" class="btn btn-outline-danger waves-effect" onclick="goBack()" style="font-size:x-large"><i class="fas fa-times-circle fa-3x" style="color: red"></i>Go Back</button>
                            </div>

                        </div>

                    </div>
                </div>

                <div class="col-md-12 middleContainerDownload" id="middleContainerDownload">
                    <!--<div class="text-center">-->
                    <div class="row">
                        <div class="col-md-6 offset-3" align="center">
                            <span class="badge badge-success"> Your file has successfully converted to unicode</span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 offset-3">
                            <img src="style/img/word.png"  class="img-fluid" alt="" style="display:block;margin:auto;">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 offset-3" align="center">
                            <span class="badge badge-success" id="filename"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 offset-2">
                            <div class="row justify-content-center">
                                <button type="button" class="btn btn-outline-danger waves-effect" onclick="goBack()" style="font-size:x-large"><i class="fas fa-times-circle fa-3x" style="color: red"></i>Go Back</button>
                                <button class="btn btn-outline-danger waves-effect" id="download" onclick="download()" style="font-size:x-large; font-weight: bold"><i class="fas fa-download fa-3x" style="color: blue"></i> &nbsp;Download</button>

                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h4 class="modal-title w-100 font-weight-bold">Sign In to Continue</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-sm-8 offset-2">
                            <div class="row">
                                <div class="col-sm-4 offset-1">
                                    <img src="style/img/logo/logoUoM.png" class="img-fluid " alt="zoom">
                                </div>
                                <div class="col-sm-6 offset-1">
                                    <img src="style/img/logo/Pleco.jpg" class="img-fluid " alt="zoom">
                                </div>
                            </div>

                        </div>

                    </div>
                    <hr class="half-rule">
                    <div class="modal-body mx-3">
                       <div class="row justify-content-center">
                           <a type="button" class="btn btn-lg" style="background-color: #3b5998" href="/login/facebook"><i class="fab fa-facebook-f pr-1"></i>&nbsp;Log in with Facebook</a>
                       </div>

                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button class="btn" onclick="$('#modalRegisterForm').modal('toggle')"><i class="far fa-times-circle"></i>&nbsp;Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <p style="font-size:20px;font-family: uom;">Supported Fonts</p>
            <ul class="list-group">
                <li class="list-group-item active #b71c1c red darken-4">Tamil</li>
                <li class="list-group-item">Kalaham</li>
                <li class="list-group-item">T06ThibusTru</li>
                <li class="list-group-item">Baamini</li>
                <li class="list-group-item">Bamini</li>
                <li class="list-group-item">T02Thibus</li>
                <li class="list-group-item">T04ThibusTru</li>
            </ul>
        </div>
    </div>
    <div class="row">&nbsp</div>
    <div class="row">

        <!-- Footer -->

        <div class="col-xl-12" style="padding :0%">
            <!-- Footer -->
            <footer class="page-footer font-small #b71c1c red darken-4 pt-4">

                <!-- Footer Links -->
                <div class="container-fluid text-center text-md-left">

                    <!-- Grid row -->
                    <div class="row">

                        <!-- Grid column -->
                        <div class="col-md-6 mt-md-0 mt-3">

                            <!-- Content -->
                            <h5 class="text-uppercase">Welcome</h5>
                            <p>Unicode pleco is a universal sinhala/Tamil non unicode to unicode docx converter. The
                                projected was initiated by Natural Language Processing unit in University of Moratuwa
                                and developed by Ciperlabs.The name "Pleco" was derived from "plecostomus".
                                "Plecostomus" is a fish who cleans dirts/algae in the water. We also hope to clen
                                non-unicode text from your docx file.</p>

                        </div>
                        <!-- Grid column -->

                        <hr class="clearfix w-100 d-md-none pb-3">
                        <!-- Grid column -->
                        <div class="col-md-3 mb-md-0 mb-3">

                            <!-- Links -->
                            <h5 class="text-uppercase">Quick Links</h5>

                            <ul class="list-unstyled">
                                <li>
                                    <a href="https://ciperlabs.com" target="_blank">Ciperlabs</a>
                                </li>
                                <li>
                                    <a href="https://www.mrt.ac.lk/web/nlp" target="_blank">NLP Center</a>
                                </li>
                                <li>
                                    <a href="https://www.mrt.ac.lk/" target="_blank">University of Moratuwa</a>
                                </li>
                            </ul>

                        </div>
                        <!-- Grid column -->
                        <!-- Grid column -->
                        <div class="col-md-3 mb-md-0 mb-3">

                            <!-- Links -->
                            <h5 class="text-uppercase">Contact Us</h5>

                            <ul class="list-unstyled">
                                <li>
                                    <p>Feel free to send us your comments, suggessions and report issues through our
                                        facebook page or mail box.</p>
                                </li>
                                <li>
                                    <a href="https://www.facebook.com/Unicode-Pleco-1949172665132215/">Facebook</a>
                                </li>
                                <li>
                                    <a href="mailto:nlu@uom.lk">nlu@uom.lk</a>
                                </li>

                            </ul>

                        </div>
                        <!-- Grid column -->


                    </div>
                    <!-- Grid row -->

                </div>
                <!-- Footer Links -->

                <!-- Copyright -->
                <div class="footer-copyright text-center py-3">© 2018 Developed by <a href="https://www.ciperlabs.com"
                                                                                      target="_blank">Ciperlabs</a> for
                    <a href="https://www.mrt.ac.lk/"> University of Moratuwa. </a>All rights Reserved.
                </div>
                <!-- Copyright -->

            </footer>
        </div>
    </div>
</div>

<!-- SCRIPTS -->
<!-- JQuery -->
<script type="text/javascript" src="style/js/jquery-3.3.1.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="style/js/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="style/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="style/js/mdb.min.js"></script>
<link rel="stylesheet" href="style/css/dropzone.css">
<script type="text/javascript" src="style/js/dropzone.js"></script>
<!-- <link rel="stylesheet" href="style.css"> -->
<style type="text/css">

    #dropzone {
        margin-bottom: 3rem;
    }

    .dropzone {
        border: 2px dashed #b71c1c;
        outline: 2px solid #b71c1c;
        outline-offset: -8px;
        border-radius: 5px;
        background: white;
    }

    .dropzone .dz-message {
        font-weight: 400;
    }

    .dropzone .dz-message .note {
        font-size: 0.8em;
        font-weight: 200;
        display: block;
        margin-top: 1.4rem;
    }

    .dropzone.dz-clickable {
        cursor: pointer;
    }
    .files input {
        outline: 2px dashed #92b0b3;
        outline-offset: -10px;
        -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
        transition: outline-offset .15s ease-in-out, background-color .15s linear;
        padding: 120px 0px 85px 35%;
        text-align: center !important;
        margin: 0;
        width: 100% !important;
    }
    .files input:focus{     outline: 2px dashed #92b0b3;  outline-offset: -10px;
        -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
        transition: outline-offset .15s ease-in-out, background-color .15s linear; border:1px solid #92b0b3;
    }
    .half-rule {
        margin:auto;
        text-align: left;
        width: 60%;
    }

</style>
<script type="text/javascript">
    $(document).ready(function(){
        function animateloop () {
            $("#progressinner").css({marginLeft: "-45%"});
            $("#progressinner").animate({
                marginLeft: "145%"
            }, 2000, function(){animateloop()});
        }
        animateloop();
    });
</script>
<script type="text/javascript" src="/webjars/js-cookie/js.cookie.js"></script>
<script type="text/javascript">
    $(".middleContainerProgress").hide();
    $(".middleContainerDownload").hide();
    $(".middleContainerErrorr").hide();
    if (localStorage.getItem("download") == "pending"){
        document.getElementById("filename").innerText = localStorage.getItem("filename")
        $(".middleContainerDownload").show();
        $(".middleContainer").hide();

    }
    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (settings.type == 'POST' || settings.type == 'PUT'
                || settings.type == 'DELETE') {
                if (!(/^http:.*/.test(settings.url) || /^https:.*/
                    .test(settings.url))) {
                    // Only send the token to relative URLs i.e. locally.
                    xhr.setRequestHeader("X-XSRF-TOKEN", Cookies
                        .get('XSRF-TOKEN'));
                }
            }
        }
    });
    $.get("/user", function (data) {
        $("#user").html(data.name);
        if (data.name == undefined) {
            logout();
        } else {
            $(".unauthenticated").hide();
            $(".authenticated").show();
            localStorage.setItem("status","success");

        }
    });
    var logout = function () {
        $.post("/logout", function () {
            $("#user").html('');
            $(".unauthenticated").show();
            $(".authenticated").hide();
            localStorage.setItem("status","notLoggedIn");

        });
        return true;
    };

    function fileUpload() {
        $(".middleContainer").hide();
        $(".middleContainerProgress").show();

        // var file = document.getElementById("fileInput").files[0];
        var file = Dropzone.instances[0].files[0];
        console.log(file);

        var formData = new FormData();

        // add assoc key values, this will be posts values
        formData.append("file", file);

        $.ajax({
            type: "POST",
            url: "/upload",
            success: function (data) {
                // your callback here
                console.log(data.status);
                localStorage.setItem("conversionId",data.conversionId);
                localStorage.setItem("download","pending");
                localStorage.setItem("filename",data.filename);
                document.getElementById("filename").innerText = localStorage.getItem("filename");

                if(data.status == "notLoggedIn"){
                    localStorage.setItem("status","notLoggedIn")
                    $(".middleContainerDownload").show();
                    $(".middleContainerProgress").hide();

                }
                else if(data.status == "success"){
                    $(".middleContainerDownload").show();
                    $(".middleContainerProgress").hide();

                }

            },
            error: function (error) {
                // handle error
                console.log("error");
                $(".middleContainerProgress").hide();
                $(".middleContainerDownload").hide();
                $(".middleContainerErrorr").show();
                $(".middleContainer").hide();

            },
            async: true,
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            timeout: 60000
        });

    }
    function goBack() {
        localStorage.removeItem("download");
        localStorage.removeItem("status");
        localStorage.removeItem("filename");
        localStorage.removeItem("conversionId");
        $(".middleContainerDownload").hide();
        $(".middleContainerErrorr").hide();
        $(".middleContainerProgress").hide();
        $(".middleContainer").show();
    }

    function download(){
        console.log("download");
        if (localStorage.getItem("status")==="notLoggedIn"){
            $("#modalRegisterForm").modal('show');
            console.log("not Logged In");
        }
        else{

            var formData = new FormData();
            formData.append("conversionId", localStorage.getItem("conversionId"));
            console.log(localStorage.getItem("conversionId"));

            var req = new XMLHttpRequest();
            var urlToSend = "/download?convertionid="+localStorage.getItem("conversionId");
            req.open("GET", urlToSend, true);
            req.responseType = "blob";
            req.onload = function () {
                var blob = req.response;
                // var fileName = req.getResponseHeader("filename") //if you have the fileName header available
                var fileName = localStorage.getItem("filename")
                // var link=document.createElement('a');
                // link.href=window.URL.createObjectURL(blob);
                // link.download=fileName;
                // link.click();

                if (navigator.msSaveBlob) { // IE 10+
                    navigator.msSaveBlob(blob, filename);
                } else {
                    var link = document.createElement("a");
                    if (link.download !== undefined) { // feature detection
                        // Browsers that support HTML5 download attribute
                        var url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", fileName);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
            };

            req.send()
        }

    }
</script>
</body>

</html>

<!--/.Navbar -->